pipeline {
    agent {label "stage"}

    stages {


         stage('clean_ws') {
            steps {
                cleanWs()
            }
        }
            
        stage('Deploy to Staging') {
            steps {
                    sh 'sudo docker pull $DOCKER_REPOSITORY/weight-tracker:$build_number'
                    sh 'sudo docker run -d -p 8080:8080 $DOCKER_REPOSITORY/weight-tracker:$build_number'
            }
        }
        

        stage('Wait for Approval') {
            
            steps{

                input "Deploy to prod?"
           }
        }


        stage('Deploy to prod') {
           
            steps {
                echo 'Prod..'
            }
        }
    }
     environment {
        build_number = {'http://10.0.0.7:8080/job/CI/lastSuccessfulBuild/buildNumber'}
        DOCKER_REPOSITORY = 'nirh237'
        DOCKER_CREDS = credentials('docker-password')
    }
}